<template>
	<div class="dxqt">

		<div class="lgc-bg slds-text-align_left dx-box1 slds-box slds-m-horizontal_xx-small">
			<div class="slds-grid slds-wrap">
				<div class="slds-col slds-text-align_left" style="padding-top:2px;">
					<lightning-button-group>
						<lightning-button label={activateTemplateLabel} onclick={handleAllButtonsClicked} disabled={isActivateTemplateDisabled}>
						</lightning-button>
						<lightning-button label="Clone Template" onclick={handleAllButtonsClicked}></lightning-button>
						<lightning-button label="Delete Template" onclick={handleAllButtonsClicked}>
						</lightning-button>
						<lightning-button label="Refresh Template" onclick={handleAllButtonsClicked}>
						</lightning-button>
						<template if:true={showPreview}>
							<lightning-button label="Preview Template" onclick={handleAllButtonsClicked}>
							</lightning-button>
						</template>
					</lightning-button-group>
					<lightning-badge label={relatedtoTypeObjName} class="slds-badge_inverse slds-m-left_medium">
					</lightning-badge>
				</div>

				<div class="slds-col slds-text-align_right">
					<lightning-layout class="slds-grid slds-grid_align-end">
						<div data-id='section menu' class="slds-col slds-grid_align-end"></div>
						<lightning-button-icon icon-name="utility:help_doc_ext" onclick={handlehelp} alternative-text="Need Help?" title="Need Help?" class="slds-button_icon-help slds-m-right_small" size="medium" variant="bare" data-val="DxTemplates" style="padding-top:5px;"></lightning-button-icon>
						<lightning-button-group data-id='section menu items' class="slds-button-group" role="group">

							<lightning-button-icon icon-name="utility:snippet" alternative-text="Section : Context"
								title="Section : Context" onclick={handleAllButtonsClicked} disabled={disableEditing}>
							</lightning-button-icon>
							<lightning-button-icon icon-name="utility:strategy"
								alternative-text="Section : Related Objects" title="Section : Related Objects"
								onclick={handleAllButtonsClicked} disabled={disableEditing}></lightning-button-icon>
							<lightning-button-icon icon-name="utility:task" alternative-text="Section : Clause"
								title="Section : Clause" onclick={handleAllButtonsClicked} disabled={disableEditing}>
							</lightning-button-icon>
							<lightning-button-icon icon-name="utility:table" alternative-text="Section : Table"
								title="Section : Table" onclick={handleAllButtonsClicked} disabled={disableEditing}>
							</lightning-button-icon>
							<span style="line-height:32px"> &nbsp; - &nbsp; </span>
							<lightning-button-icon icon-name="utility:edit" alternative-text="Edit Template"
								title="Edit Template" onclick={handleAllButtonsClicked}>
							</lightning-button-icon>
						</lightning-button-group>
					</lightning-layout>
				</div>

			</div>
		</div>
		<div class="dx-box1bot slds-box">

			<div class="slds-grid slds-wrap">

				<div class="slds-col slds-size_9-of-12">
					<div class="slds-grid slds-wrap slds-p-right_small">

						<div class="slds-col slds-size_12-of-12">
							<!-- <template if:true={isTemplateSectionsFetched}> -->
							<c-template-header showheaderdetails={showheaderdetails}
								selected-object-name={relatedtoTypeObjChild} recordidvalueprop={recordIDValueprop}
								rowcount={header.rowCount} sectiontype={header.Type}
								ondeletesectiondata={handledeletesectiondata} onsavesectiondata={handlesavedheaderdata}
								recordidtoedit={recordidtoedit} sectionrecordid={header.Id}
								documenttemplaterecord={doctemplatedetails} pdf-links ={pdfLinksData} ondatasaved={handleDataSaved}>
							</c-template-header>

							<c-template-content-details showdetails={showcontextdetails}
								selected-object-name={relatedtoTypeObjChild} recordidvalueprop={recordIDValueprop} wherecondition = {whereCondition}
								rowcount={rowCount} sectiontype={SectionTypename} ondatasaved={handleDataSaved}
								onsavesectiondata={handlesavedsectiondata} ondeletesectiondata={handledeletesectiondata}
								showclausescreen={showclausescreen} recordidtoedit={recordidtoedit}
								sectionrecordid={selectedSectionRecordID} documenttemplaterecord={doctemplatedetails} pdf-links ={pdfLinksData}> </c-template-content-details>


							<c-template-table-details showtabledetails={showtabledetails}
								selected-object-name={relatedtoTypeObjChild} recordidvalueprop={recordIDValueprop}
								rowcount={rowCount} sectiontype={SectionTypename}
								onsavesectiondata={handlesavedsectiondata} ondeletesectiondata={handledeletesectiondata}
								recordidtoedit={recordidtoedit} sectionrecordid={selectedSectionRecordID}
								documenttemplaterecordid={doctemplatedetails.Id}
								documenttemplaterecord={doctemplatedetails} ondatasaved={handleDataSaved}>
							</c-template-table-details>

							<c-template-related-objects showrelatedobjectdetails={showrelatedobjectdetails}
								selected-object-name={relatedtoTypeObjChild} recordidvalueprop={recordIDValueprop}
								rowcount={rowCount} sectiontype={SectionTypename}
								onsavesectiondata={handlesavedsectiondata} ondeletesectiondata={handledeletesectiondata}
								recordidtoedit={recordidtoedit} sectionrecordid={selectedSectionRecordID}
								documenttemplaterecordid={doctemplatedetails.Id} ondatasaved={handleDataSaved}
								documenttemplaterecord={doctemplatedetails} pdf-links ={pdfLinksData}>
							</c-template-related-objects>

							<c-template-footer showfooterdetails={showfooterdetails}
								selected-object-name={relatedtoTypeObjChild} recordidvalueprop={recordIDValueprop}
								rowcount={footer.rowCount} sectiontype={footer.Type} ondatasaved={handleDataSaved}
								ondeletesectiondata={handledeletesectiondata} onsavesectiondata={handlesavedfooterdata}
								recordidtoedit={recordidtoedit} sectionrecordid={footer.Id}
								documenttemplaterecord={doctemplatedetails} pdf-links ={pdfLinksData}>
							</c-template-footer>
							<!-- </template> -->
						</div>
					</div>
				</div>

				<div class="slds-col slds-size_3-of-12">
					<div class="slds-align_absolute-center slds-box slds-p-top_small">
						<strong>TEMPLATE SECTIONS</strong>
					</div>
					<div class="">
						<div if:true={isLoaded2} class="slds-is-relative">
							<lightning-spinner alternative-text="Loading..." variant="brand">
							</lightning-spinner>
						</div>
					</div>
					<template if:true={opensection}>
						<div class="container2" aria-multiselectable="true"
							style="width: 100%; display:flex; flex-flow:column;">

							<div class="">
								<div if:true={isLoaded} class="slds-is-relative">
									<lightning-spinner alternative-text="Loading..." variant="brand">
									</lightning-spinner>
								</div>
							</div>

							<template if:true={header}>
								<div class="grabable" key={header.Id} id={header.Id} data-drag-id={header.Id} data-sectiontype={header.Type}
									data-onload='templateHeader' onclick={handleAllButtonsClicked} data-index={header.Id}
									data-id={header.Id}>
									<div scope="col" class="slds-grid slds-wrap"
										style="padding:10px 10px 10px 10px; width:100%; box-shadow:0px 0px 2px rgb(229, 229, 229)">
										<lightning-icon icon-name="utility:drag_and_drop" size="small"></lightning-icon>
										<div scope="col" class="slds-col" hidden>{header.Id}</div>
										<div scope="col" class="slds-col">
											<div
												style="font-size:12px;line-height:14px; position:absolute; margin-top:-4px; font-style:italic;">
												{header.Type}
											</div>
											<div id={header.Id}
												style="font-size:14px;margin: 8px 0px -8px 10px; font-weight:600;"
												key={header.Id}>
												{header.sectionNameEntered}
											</div>
										</div>
									</div>
								</div>
							</template>

							<template if:true={sections}>
								<template for:each={sections} for:item="section" for:index="index">
									<div class="grabable" key={section.Id} id={section.Id} draggable="true"
										data-drag-id={index} ondragstart={onDragStart} ondragover={onDragOver}
										data-sectiontype={section.Type}
										ondrop={onDrop} onclick={handleAllButtonsClicked} data-index={index} data-id={index}>

										<div scope="col" class="slds-grid slds-wrap"
											style="padding:10px 10px 10px 10px; width:100%; box-shadow:0px 0px 2px rgb(229, 229, 229)">
											<lightning-icon icon-name="utility:drag_and_drop" size="small">
											</lightning-icon>
											<div scope="col" class="slds-col myId" hidden>{section.Id}</div>
											<div scope="col" class="slds-col">
												<div
													style="font-size:12px;line-height:14px; position:absolute; margin-top:-4px; font-style:italic;">
													{section.Type}
												</div>
												<div id={section.Id}
													style="font-size:14px;margin: 8px 0px -8px 10px; font-weight:600;"
													key={section.Id}>
													{section.sectionNameEntered}
												</div>
											</div>
											<div scope="col"
												class="slds-col slds-float_right slds-text-align_right myIndex" hidden>
												{index}
											</div>
										</div>

									</div>
								</template>
							</template>
							<template if:false={sections}>No rows found.</template>

							<template if:true={footer}>
								<div class="grabable" key={footer.Id} id={footer.Id} data-drag-id={footer.Id} data-sectiontype={footer.Type}
									data-onload='templateFooter' onclick={handleAllButtonsClicked} data-index={footer.Id}
									data-id={footer.Id}>
									<div scope="col" class="slds-grid slds-wrap"
										style="padding:10px 10px 10px 10px; width:100%; box-shadow:0px 0px 2px rgb(229, 229, 229)">
										<lightning-icon icon-name="utility:drag_and_drop" size="small"></lightning-icon>
										<div scope="col" class="slds-col" hidden>{footer.Id}</div>
										<div scope="col" class="slds-col">
											<div
												style="font-size:12px;line-height:14px; position:absolute; margin-top:-4px; font-style:italic;">
												{footer.Type}
											</div>
											<div id={footer.Id}
												style="font-size:14px;margin: 8px 0px -8px 10px; font-weight:600;"
												key={footer.Id}>
												{footer.sectionNameEntered}
											</div>
										</div>
									</div>
								</div>
							</template>

						</div>
					</template>
				</div>
			</div>

			<c-modal onclosedialog ={handleDialogBoxClosed}>
				<template if:true={previewModal}>
					<span slot="header"> Preview Template </span>

					<div class="slds-modal__content slds-p-around_medium" style="min-height: 240px;">
						<c-multi-lookup-component label-name={previewLabel} object-api-name={relatedtoTypeObjName}
							field-api-names="Id,Name" filter-field-api-name="Name" icon-name="standard:account"
							onsinglepill={selectItemEventHandler} onremovepill={updateItemEventHandler}
							has-multi-select="false" where-clause="">
						</c-multi-lookup-component>
					</div>

					<footer class="slds-modal__footer">
						<div class="slds-text-align_right">
							<lightning-button class="slds-p-right_x-small" variant="brand" label="Preview"
								title="preview" disabled={navigateToPreview} onclick={showpreviewtemplate}>
							</lightning-button>
							<lightning-button class="slds-p-right_x-small" variant="brand" label="Cancel"
								onclick={closePreviewModal}></lightning-button>
						</div>
					</footer>
				</template>

				<template if:true={showTemplate}>
					<span slot="header"> Preview </span>
					<div class="slds-modal__content slds-p-around_medium">
						<div style="overflow-y:auto; height:calc(100vh - 200px)">
							<c-dx-show-selected-template template-id={templateId} object-record-id={previewRecordId}
								object-name={relatedtoTypeObjName}>
							</c-dx-show-selected-template>
						</div>
					</div>

					<footer class="slds-modal__footer">
						<div class="slds-text-align_right">
							<lightning-button class="slds-m-left_small" variant="brand" label="Back"
								onclick={handlePreviewBackButton}>
							</lightning-button>
							<lightning-button class="slds-m-left_small" variant="brand" label="Cancel"
								onclick={closePreviewModal}>
							</lightning-button>
						</div>
					</footer>
				</template>

				<template if:true={showCloneTemplate}>
					<span slot="header">Clone Template</span>
					<div class="slds-modal__content slds-p-around_medium" style="min-height: 240px;">
						<c-clone-document-cmp record-id={recordId} object-api-name="DxCPQ__Document_Template__c"
							parent-template-related-to-type={relatedtoTypeObjName} ondoccreated={cloneTemplateHandler}>
						</c-clone-document-cmp>
					</div>
				</template>

				<template if:true={showDeleteTemplate}>
					<span slot="header">Delete Template</span>
					<div class="slds-modal__content slds-p-around_medium" style="min-height: 140px;">
						<div class="slds-align_absolute-center">
							<br><br><br><br><br><br>
							<span slot="header">Are you sure, you want to permanantly delete this template ?</span>
						</div>
					</div>

					<footer class="slds-modal__footer">
						<div class="slds-text-align_right">
							<lightning-button class="slds-m-left_small" label="Cancel" variant="neutral"
								onclick={cancelDeleteHandler}></lightning-button>
							<lightning-button class="slds-m-left_small" label="Delete" variant="brand"
								onclick={permanantDeleteHandler}></lightning-button>
						</div>
					</footer>
				</template>

				<template if:true={editTemplate}>
					<span slot="header">Edit Template</span>
					<div class="slds-modal__content slds-p-around_medium" style="min-height: 240px;">
						<lightning-record-edit-form record-id={documenttemplaterecordid}
							object-api-name="DxCPQ__Document_Template__c" onsuccess={handleEditSuccess}>
							<lightning-input-field field-name="Name" disabled ={readonlyVal}> </lightning-input-field>
							<lightning-output-field field-name="DxCPQ__Related_To_Type__c"> </lightning-output-field>
							<lightning-input-field field-name="DxCPQ__Description__c" disabled ={readonlyVal}> </lightning-input-field>
							<lightning-output-field field-name="DxCPQ__Version_Number__c"> </lightning-output-field>
							<!-- Changes by Reethika - selecting apex classes and auto launched flows -->
							<div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">
								<label class="slds-checkbox_toggle slds-grid">
									<label class="slds-form-element__label slds-no-flex">PROCESS TYPE</label>
									<input type="checkbox" class="slds-p-top_x-large" name="checkbox-toggle-16"
										onchange={handleRelationshipType} checked={isBundled}
										aria-describedby="checkbox-toggle-16" />
									<span id="checkbox-toggle-16" class="slds-checkbox_faux_container" aria-live="assertive">
										<span class="slds-checkbox_faux"></span>
										<span class="slds-checkbox_on">APEX CLASS</span>
										<span class="slds-checkbox_off">FLOW</span>
									</span>
								</label>
							</div>
							<template if:true={isBundled}>
								<c-search-category has-multi-select="false" data-id="search" options={classTypeOptions}
								label="Select the class name" searchtext="Select the class name"
								onselectedcategoryvalues={handleClassselection} disabled={isDisabled}></c-search-category>
							</template>
							<template if:false={isBundled}>
								<c-search-category has-multi-select="false" data-id="object" options={flowTypeOptions}
								label="Select the flow name" data-search searchtext="Select the flow name"
								onselectedcategoryvalues={handleFlowselection} disabled={isDisabled}></c-search-category>
							</template>
							<div class="slds-text-align_right">
								<lightning-button class="slds-m-top_small" type="submit" label="Save" variant="brand" if:false={readonlyVal}>
								</lightning-button>
							</div>
						</lightning-record-edit-form>
						<div class="slds-text-align_left">
							<lightning-button class="slds-m-top_small" type="submit" label="Watermark Settings"
								variant="brand" onclick={handleWatermarkSettings}></lightning-button>
								<lightning-button-icon icon-name="utility:help_doc_ext" onclick={handlehelp} alternative-text="Need Help?" title="Need Help?" class="slds-button_icon-help slds-m-right_small" size="medium" variant="bare" style="margin-top: 3px;" data-val="Watermark Settings"></lightning-button-icon>
						
						</div>

					</div>
					<footer class="slds-modal__footer"></footer>
				</template>

				<template if:true={showwatermarkbtn}>
					<!-- Modal Code added by Bhavya for watermark starts-->
					<span slot="header">Watermark Settings</span>
					<div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1"
						style="max-height: 500px;">
						<lightning-tabset>
							<lightning-tab label="Text" onactive={handleTabChange} data-name="Text">

								<div class="slds-grid slds-wrap slds-gutters_small slds-grid_vertical-align-center">
									<div
										class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
										<lightning-input type="text" label="Watermark Text" value={watermarkText}
											onchange={handleWatermarkChange} data-label="watermarkText" disabled ={readonlyVal}>
										</lightning-input>
									</div>
									<div
										class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
										<lightning-input type="color" name="input-color" label="Color"
											value={colorValue} data-label="color" onchange={handleWatermarkChange} disabled ={readonlyVal}>
										</lightning-input>
									</div>
									<div
										class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
										<lightning-combobox name="FontSize" label="Font Size" value={fontSizeValue}
											placeholder="" data-label="fontSize" options={fontSizeOptions}
											onchange={handleWatermarkChange} disabled ={readonlyVal}> </lightning-combobox>
									</div>
									<div
										class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
										<lightning-slider class="rotationSlider" label="Rotation" size="x-small"
											value={rotationValue} onchange={handleRotationChange} data-label="rotation"
											min="-180" max="180" step="5" data-type="Text" disabled ={readonlyVal}></lightning-slider>
									</div>
									<div
										class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
										<lightning-combobox name="opacity" label="Opacity" data-label="opacity"
											value={opacityValue} placeholder="" options={opacityOptions}
											onchange={handleWatermarkChange} disabled ={readonlyVal}> </lightning-combobox>
									</div>
									<div
										class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
										<lightning-input type="checkbox" label="Primary" name="textPrimary"
											checked={checkedValText} onchange={handleWatermarkPrimary}
											data-label="textPrimary" disabled ={readonlyVal}></lightning-input>
									</div>
								</div>
								<div class="slds-grid slds-gutters_small">
									<template for:each={watermarkPageOptionsText} for:item="item">
										<fieldset key={item.value} style="display: block; float: left;">
											<div class="slds-form-element__control" style="margin:15px 0px 10px 15px">
												<span class="slds-radio">
																<input name="radiogroup" id={item.value} type="radio" value={item.value} onchange={handleWatermarkPageChange} checked = {item.checked} disabled ={readonlyVal}/>
																<label class="slds-radio__label" for={item.value}>
																	<span class="slds-radio_faux"></span>
												<span class="slds-form-element__label" style="display: inline !important;">{item.label}</span>
												</label>
												</span>
											</div>
										</fieldset>
									</template>
								</div>
								<div
									class="slds-grid slds-grid_vertical-align-center slds-grid_align-center slds-text-align_center">
									<div class="output-container slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12 "
										style="border:1px solid #333;">
										<canvas id="outputCanvas" class="canvasText" width="600px"
											height="600px"></canvas>
									</div>
								</div>

							</lightning-tab>
							<lightning-tab label="Image" onactive={handleTabChange} data-name="Image" >
								<div class="slds-grid slds-wrap slds-gutters_small slds-grid_vertical-align-center">
									<div
										class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
										<input type="file" accept="image/*" onchange={handleUploadFinished} disabled ={readonlyVal}>
												</div>
										<div
											class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
											<lightning-slider label="Image Scaling %" size="x-small"
												value={imageScalingValue} onchange={handleWatermarkChange} min="0"
												max="200" data-label="imagescaling" disabled ={readonlyVal}></lightning-slider>
										</div>
										<div
											class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
											<lightning-combobox name="opacityImage" label="Opacity"
												value={opacityImageValue} placeholder="" data-label="opacityImage"
												options={opacityOptions} onchange={handleWatermarkChange} disabled ={readonlyVal}>
											</lightning-combobox>
										</div>
										<div
											class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
											<lightning-slider class="rotationSlider" label="Rotation" size="x-small"
												value={rotationImagevalue} onchange={handleRotationChange}
												data-label="rotation" min="-180" max="180" step="5" data-type="Image" disabled ={readonlyVal}>
											</lightning-slider>
										</div>

										<div
											class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
											<lightning-input type="checkbox" label="Primary" name="imagePrimary"
												checked={checkedValImage} onchange={handleWatermarkPrimary} disabled ={readonlyVal}
												data-label="imagePrimary"></lightning-input>
										</div>
									</div>
									<div class="slds-grid slds-wrap slds-gutters_small">
										<template for:each={watermarkPageOptionsImage} for:item="item">
											<fieldset key={item.value} style="display: block; float: left;">
												<div class="slds-form-element__control"
													style="margin:15px 0px 10px 15px">
													<span class="slds-radio">
															<input name="radiogroupforImage" id={item.value} type="radio" value={item.value} onchange={handleWatermarkPageChange} checked = {item.checked} disabled ={readonlyVal}/>
															<label class="slds-radio__label" for={item.value}>
																<span class="slds-radio_faux"></span>
													<span class="slds-form-element__label" style="display: inline !important;">{item.label}</span>
													</label>
													</span>
												</div>
											</fieldset>
										</template>
									</div>
									<div class="slds-grid slds-grid_vertical-align-center slds-grid_align-center slds-text-align_center">
										<div class="output-container slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12 "
											style="border:1px solid #333;">
											<canvas class="canvasImage" width="800px" height="800px"></canvas>


										</div>
									</div>
							</lightning-tab>
						</lightning-tabset>

					</div>
					<div class="slds-modal__footer">
						<button class="slds-button slds-button_neutral" aria-label="Cancel and close" onclick={handleWaterMarkCancel} >Cancel</button>
						<button class="slds-button slds-button_brand" onclick={handleWaterMarkSave} if:false={readonlyVal}>Save</button>
					</div>
				</template>
			</c-modal>



			<!---Watermark code ends here -->
		</div>
	</div>
</template>