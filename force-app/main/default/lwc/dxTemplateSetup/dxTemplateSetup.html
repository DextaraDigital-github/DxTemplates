<template>
	<div class="dxt">
		<div class="slds-grid slds-wrap dx-w-100p">
			<div class="slds-col">
				<div class="ag_lp_base dx-customleftmenufixer">
					<div class="slds-col sidenavleft">
						<!-- Changes by Kapil - fix for SObj Filters -->
						<lightning-button-group class="slds-float_right" style="padding-top:40px; margin: 2px 10px 0px 0px;">
							<lightning-button-icon onclick={handleAllButtonsClicked} data-id="import" title="Import templates" variant="border-filled" icon-name="utility:upload" style="z-index:1;"></lightning-button-icon>
							<lightning-button-icon onclick={handleAllButtonsClicked} data-id="export" title="Export templates" variant="border-filled" icon-name="utility:download" style="z-index:1;"></lightning-button-icon>
						</lightning-button-group>
						<c-menu-setup if:true={documentsExist} grid-data={docGridData} is-template='true' template-value={templateRelatedTo}
							placeholder-text="Search..." onactive={handleTemplateSelection} related-type-option-data={relatedTypeOptions} 
							onnewtemplate={handleNewTemplateCreationscreen} onfilteredvalue={handleFilterSelection} is-saved={isSaved} ondatasaved={handleDataSaved}>
						</c-menu-setup>
					</div>

				</div>
			</div>
			<div class="slds-col dx-p-left_200 ">
				<template if:true={showUpdatedTemplate}>
					<c-template-designer-c-m-p record-id={selectedDocumentId} relatedto-type-obj-name={relatedtoTypeObj}
						ondoccreated={handleNewTemplateCreation} ondeletetemplate={deleteTemplateHandler}
						ondocedited={editTemplateHandler} ondatasaved={handleDataSaved} is-saved={isSaved}>
					</c-template-designer-c-m-p>
				</template>
			</div>
		</div>

		<c-modal onclosedialog ={handleDialogBoxClosed}>
			<template if:true={showImportTemplates}>
				<span slot="header">Import Templates</span>
				<header style="background-color: #ffffff;padding: 1% 0;">
					<lightning-progress-indicator current-step={currentStep} type="base" variant="base">
						<lightning-progress-step label="" value="1" data-step = "1">
						</lightning-progress-step>
						<lightning-progress-step label="" value="2" data-step = "2">
						</lightning-progress-step>
						<lightning-progress-step label="" value="3" data-step = "3">
						</lightning-progress-step>
					</lightning-progress-indicator>
				</header>
				<template if:true={showFirstImportScreen}>
					<div style="background-color: #ffffff;padding: 1% 16px;">
						<div>
							<input type="file" accept="json/*" onchange={handleJSONUpload} class="dx-button">
							<lightning-textarea name="import" label="Paste JSON" placeholder="paste here..." value={jsonData} onchange={pastedjson}></lightning-textarea>
						</div>
						<br>
						<div class="slds-text-align_right">
							<lightning-button variant="neutral" label="Create" title="Create template based on above JSON" onclick={createTemplateData} disabled={createDisabledButton}> </lightning-button>
						</div>
						<br>
					</div>
				</template>
				<template if:true={showDuplicateTemplates}>
					<div style="background-color: #ffffff;padding: 1% 16px;">
						<div>
							{errorMessage}
						</div>
						<!-- <div class="slds-text-align_right" style="padding: 16px;">
							<lightning-button variant="brand" label="Skip" title="Skip" onclick={skipTemplate} style="margin: 6px;"></lightning-button>
							<lightning-button variant="neutral" label="Create as new version" title="Create as new version" onclick={continueTemplate}></lightning-button>
						</div> -->
					</div>
				</template>
				<template if:true={showTemplateMessage}>
					<div style="background-color: #ffffff;padding: 1% 16px;">
						{templateSuccessMessage}
					</div>
					<div class="slds-text-align_right">
						<lightning-button variant="neutral" label="Done" title="Done" onclick={refreshPageAfterCreate}> </lightning-button>
					</div>
				</template>
			</template>

			<template if:true={showAllTemplates}>
				<span slot="header">Export templates</span>
				<div style="background-color: #ffffff;padding: 1% 16px;">
					<lightning-dual-listbox name="templates"
                            label="Select Templates"
                            source-label="Available Templates"
                            selected-label="Selected Templates"
                            options={templatesOptions}
                            onchange={handleExportTemplateList}>
					</lightning-dual-listbox>
					<div class="slds-text-align_right" style="padding: 16px;">
						<template if:true={showPreviewButton}>
							<lightning-button variant="neutral" label={previewLabel} title="Preview Selected Templates" onclick={exportTemplateList} style="margin: 6px;"></lightning-button>
						</template>
						<lightning-button variant="brand" label="Download" title="Download Templates" onclick={downloadJson}></lightning-button>
					</div>
					<template if:true={showPreviewButton}>
						<template if:true={showTextArea}>
							<!-- <div class="slds-text-align_right">
								<lightning-button-icon variant="container" icon-name="utility:copy_to_clipboard" title="Copy to clipboard"></lightning-button-icon>
							</div> -->
							<div style="padding: 0px 16px 0px 0px;">
								<div class="slds-text-align_right">
									<lightning-button-icon variant="bare" icon-name="utility:copy_to_clipboard" title="Copy to clipboard" onclick={copyJsonData} style="position: absolute;z-index: 1;margin: 28px 0px 0px -36px;"></lightning-button-icon>
								</div>
								<lightning-textarea label="JSON Preview" name="Data" readonly value={exportList} style="height:180px;"> 
								</lightning-textarea>
							</div>
						</template>
					</template>
				</div>
			</template>
			<!------Progress bar code added by Bhavya ends here------>
			<template if:true={showAddNewTemplate}>
				<span slot="header">Add New Template</span>
				<div class="slds-modal__content slds-p-around_small dx-lrf-std-cstm-1" style="min-height: 240px;">
					<lightning-record-edit-form object-api-name="DxCPQ__Document_Template__c"
						onsubmit={handleCreateSubmit}>
						<div class="slds-grid slds-wrap">
							<div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">
								<lightning-input-field field-name="Name" required> </lightning-input-field>
							</div>
							<div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">
								<lightning-input-field field-name="DxCPQ__Related_To_Type__c"
									onchange={handleRelatedToTypeChange} required> </lightning-input-field>
							</div>
							<div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">
								<lightning-input-field field-name="DxCPQ__Version_Number__c" value="1" read-only="true">
								</lightning-input-field>
							</div>
							<div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">
								<lightning-input-field field-name="DxCPQ__Description__c"> </lightning-input-field>
							</div>
							<!-- Changes by Reethika - selecting apex classes and auto launched flows -->
							<div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">
								<label class="slds-checkbox_toggle slds-grid">
									<label class="slds-form-element__label slds-no-flex">PROCESS TYPE</label>
									<input type="checkbox" class="slds-p-top_x-large" name="checkbox-toggle-16"
										onchange={handleRelationshipType}
										aria-describedby="checkbox-toggle-16" />
									<span id="checkbox-toggle-16" class="slds-checkbox_faux_container" aria-live="assertive">
										<span class="slds-checkbox_faux"></span>
										<span class="slds-checkbox_on">APEX CLASS</span>
										<span class="slds-checkbox_off">FLOW</span>
									</span>
								</label>
							</div>
							<div class="slds-col slds-size_1-of-1 slds-medium-size_6-of-12">
								<template if:true={isBundled}>
								 	<c-search-category has-multi-select="false" data-id="object" options={classTypeOptions}
						     label="Select the class name" searchtext="Select the class name"
						     onselectedcategoryvalues={handleClassselection} disabled={isDisabled}></c-search-category>
								</template>
								<template if:false={isBundled}>
								 	<c-search-category has-multi-select="false" data-id="object" options={flowTypeOptions}
						     label="Select the flow name" searchtext="Select the flow name"
						     onselectedcategoryvalues={handleFlowselection} disabled={isDisabled}></c-search-category>
									</template>
							</div>
						</div>

						<div class="slds-text-align_right">
							<lightning-button class="slds-m-top_small" type="submit" label="Save" variant="brand">
							</lightning-button>
						</div>
					</lightning-record-edit-form>
				</div>
				<footer class="slds-modal__footer"> </footer>
			</template>
	
			<template if:true={showwatermarkbtn}>
					<span slot="header">Watermark Settings</span>
					<div class="slds-modal__content slds-p-around_medium"
								id="modal-content-id-1" style="max-height: 400px;"> 
								<lightning-tabset>
									<lightning-tab label="Text" onactive={handleTabChange} data-name="Text">
										<div class="slds-grid slds-wrap slds-gutters_small slds-grid_vertical-align-center">
											<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
												<lightning-input type="text" label="Watermark Text" value={watermarkText}
													onchange={handleWatermarkChange} data-label="watermarkText">
												</lightning-input>
											</div>
											<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
												<lightning-input type="color" name="input-color" label="Color"
													value={colorValue} data-label="color" onchange={handleWatermarkChange}>
												</lightning-input>
											</div>
											<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
												<lightning-combobox name="FontSize" label="Font Size" value={fontSizeValue}
													placeholder="" data-label="fontSize" options={fontSizeOptions}
													onchange={handleWatermarkChange}> </lightning-combobox>
											</div>
											<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
												<lightning-slider class="rotationSlider" label="Rotation" size="x-small" value={rotationvalue}
													onchange={handleRotationChange} data-label="rotation" min="-180" max="180"
													step="5" data-type = "Text"></lightning-slider>
											</div>
											<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
												<lightning-combobox name="opacity" label="Opacity" data-label="opacity"
													value={opacityValue} placeholder="" options={opacityOptions}
													onchange={handleWatermarkChange}> </lightning-combobox>
											</div>
											<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
												<lightning-input type="checkbox" label="Primary" name="textPrimary" checked={checkedValText} onchange={handleWatermarkPrimary} data-label="textPrimary"></lightning-input>
											</div>
										</div>
											<div class="slds-grid slds-gutters_small">
												<template for:each={watermarkPageOptionsText} for:item="item">
													<fieldset key={item.value} style="display: block; float: left;">
														<div class="slds-form-element__control" style="margin:15px 0px 10px 15px">
															<span class="slds-radio">
																<input name="radiogroup" id={item.value} type="radio" value={item.value} onchange={handleWatermarkPageChange} checked = {item.checked}/>
																<label class="slds-radio__label" for={item.value}>
																	<span class="slds-radio_faux"></span>
																	<span class="slds-form-element__label" style="display: inline !important;">{item.label}</span>
																</label>
															</span>
														</div>
													</fieldset>
												</template>												
											</div>
										<div class="slds-grid slds-grid_vertical-align-center slds-grid_align-center slds-text-align_center">
											<div class="output-container slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12 "
												style="border:1px solid #333;">
												<canvas id="outputCanvas" class="canvasText" width="600px"
													height="600px"></canvas>
											</div>
										</div>
									</lightning-tab>
									<lightning-tab label="Image" onactive={handleTabChange} data-name="Image">
										<div class="slds-grid slds-wrap slds-gutters_small slds-grid_vertical-align-center">
											<div
												class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
												<input type="file" accept="image/*" onchange={handleUploadFinished}>
												</div>
												<div
													class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
													<lightning-slider label="Image Scaling %" size="x-small"
														value={imageScalingValue} onchange={handleWatermarkChange} min="0"
														max="200" data-label="imagescaling"></lightning-slider>
												</div>
												<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
													<lightning-combobox name="opacityImage" label="Opacity" value={opacityImageValue} placeholder="" data-label="opacityImage" options={opacityOptions} onchange={handleWatermarkChange}> </lightning-combobox>
												</div>
												<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
													<lightning-slider class="rotationSlider" label="Rotation" size="x-small" value={rotationImagevalue} onchange={handleRotationChange} data-label="rotation" min="-180" max="180" step="5" data-type = "Image"></lightning-slider>
												</div>
												
												<div class="slds-col slds-size_1-of-1 slds-medium-size_4-of-12 slds-large-size_4-of-12">
												<lightning-input type="checkbox" label="Primary" name="imagePrimary" checked={checkedValImage} onchange={handleWatermarkPrimary} data-label="imagePrimary"></lightning-input>
											</div>
										</div>
										<div class="slds-grid slds-wrap slds-gutters_small">
											<template for:each={watermarkPageOptionsImage} for:item="item">
												<fieldset key={item.value} style="display: block; float: left;">
													<div class="slds-form-element__control" style="margin:15px 0px 10px 15px">
														<span class="slds-radio">
															<input name="radiogroupforImage" id={item.value} type="radio" value={item.value} onchange={handleWatermarkPageChange} checked = {item.checked}/>
															<label class="slds-radio__label" for={item.value}>
																<span class="slds-radio_faux"></span>
																<span class="slds-form-element__label" style="display: inline !important;">{item.label}</span>
															</label>
														</span>
													</div>
												</fieldset>
											</template>
										</div>
										<div
											class="slds-grid slds-grid_vertical-align-center slds-grid_align-center slds-text-align_center">
											<div class="output-container slds-col slds-size_1-of-1 slds-medium-size_12-of-12 slds-large-size_12-of-12 " style="border:1px solid #333;">
												<canvas class="canvasImage" width="800px" height="800px"></canvas>

												
											</div>
										</div>
									</lightning-tab>
								</lightning-tabset>
							 </div> 
							<div class="slds-modal__footer">
								<button class="slds-button slds-button_neutral" aria-label="Cancel and close" onclick={handleWaterMarkCancel}>Cancel</button>
								<button class="slds-button slds-button_brand" onclick={handleWaterMarkSave}>Save</button>
							</div>
				</template>
	</c-modal>
	</div>
</template>